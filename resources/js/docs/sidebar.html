<!DOCTYPE html>

<html>
<head>
  <title>sidebar.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="controller.html">
                controller.js
              </a>
            
              
              <a class="source" href="position.html">
                position.js
              </a>
            
              
              <a class="source" href="session.html">
                session.js
              </a>
            
              
              <a class="source" href="test.html">
                test.js
              </a>
            
              
              <a class="source" href="ui.html">
                ui.js
              </a>
            
              
              <a class="source" href="cluster.html">
                cluster.js
              </a>
            
              
              <a class="source" href="clustering.html">
                clustering.js
              </a>
            
              
              <a class="source" href="graph.html">
                graph.js
              </a>
            
              
              <a class="source" href="linkFactory.html">
                linkFactory.js
              </a>
            
              
              <a class="source" href="linkList.html">
                linkList.js
              </a>
            
              
              <a class="source" href="nodeFactory.html">
                nodeFactory.js
              </a>
            
              
              <a class="source" href="nodeList.html">
                nodeList.js
              </a>
            
              
              <a class="source" href="saveLink.html">
                saveLink.js
              </a>
            
              
              <a class="source" href="search.html">
                search.js
              </a>
            
              
              <a class="source" href="zoom.html">
                zoom.js
              </a>
            
              
              <a class="source" href="array.html">
                array.js
              </a>
            
              
              <a class="source" href="cookie.html">
                cookie.js
              </a>
            
              
              <a class="source" href="curry.html">
                curry.js
              </a>
            
              
              <a class="source" href="dateFormat.html">
                dateFormat.js
              </a>
            
              
              <a class="source" href="datepicker.html">
                datepicker.js
              </a>
            
              
              <a class="source" href="delay.html">
                delay.js
              </a>
            
              
              <a class="source" href="dimensions.html">
                dimensions.js
              </a>
            
              
              <a class="source" href="getRandomDate.html">
                getRandomDate.js
              </a>
            
              
              <a class="source" href="ical.html">
                ical.js
              </a>
            
              
              <a class="source" href="levenshtein.html">
                levenshtein.js
              </a>
            
              
              <a class="source" href="merge.html">
                merge.js
              </a>
            
              
              <a class="source" href="paragraphy.html">
                paragraphy.js
              </a>
            
              
              <a class="source" href="pdf.html">
                pdf.js
              </a>
            
              
              <a class="source" href="screen.html">
                screen.js
              </a>
            
              
              <a class="source" href="truncate.html">
                truncate.js
              </a>
            
              
              <a class="source" href="unixTime.html">
                unixTime.js
              </a>
            
              
              <a class="source" href="graph.html">
                graph.js
              </a>
            
              
              <a class="source" href="infobox.html">
                infobox.js
              </a>
            
              
              <a class="source" href="links.html">
                links.js
              </a>
            
              
              <a class="source" href="loader.html">
                loader.js
              </a>
            
              
              <a class="source" href="map.html">
                map.js
              </a>
            
              
              <a class="source" href="menu.html">
                menu.js
              </a>
            
              
              <a class="source" href="message.html">
                message.js
              </a>
            
              
              <a class="source" href="saveLink.html">
                saveLink.js
              </a>
            
              
              <a class="source" href="search.html">
                search.js
              </a>
            
              
              <a class="source" href="selectBox.html">
                selectBox.js
              </a>
            
              
              <a class="source" href="sidebar.html">
                sidebar.js
              </a>
            
              
              <a class="source" href="views.html">
                views.js
              </a>
            
              
              <a class="source" href="zoomer.html">
                zoomer.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>sidebar.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>define([<span class="string">"jquery"</span>, <span class="string">"radio"</span>, <span class="string">"util/truncate"</span>, <span class="string">"util/pdf"</span>, <span class="string">"models/nodeList"</span>, <span class="string">"util/ical"</span>, <span class="string">'params'</span>, <span class="string">"util/array"</span>, <span class="string">'js!lib/jquery/jquery-ui-1.9.1.custom.min.js!order'</span>,<span class="string">"js!lib/jquery/multiselect!order"</span>, <span class="string">'js!lib/jquery/jquery.transit.min.js!order'</span>, <span class="string">"util/unixTime"</span>, <span class="string">"params"</span>], 
<span class="keyword">function</span>($, radio, truncate, Pdf, nodeList, iCal, param, arrrr, tabbbb, tabbb, tabb, unixTime, params) {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>////////////////////////////////////////////
                                        //
              Interface                    //
                                        //
////////////////////////////////////////////</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">var</span> sidebar = {};

	<span class="keyword">var</span> isOpen = <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>////////////////////////////////////////////
                                        //
               Events                    //
                                        //
////////////////////////////////////////////</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	

	sidebar.events = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

		<span class="comment">/**
		 * Broadcast
		 */</span>



		<span class="comment">/**
		 * Subscribe
		 */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Current node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"node:select"</span>).subscribe(setFocus);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Unselect it when click somewhere else</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"node:unselect"</span>).subscribe(unsetFocus);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Select node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"node:schedule"</span>).subscribe(schedule);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>unscheduled node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"node:unschedule"</span>).subscribe(unschedule);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>On unscheduled all nodes, we should close &quot;are you sure?&quot;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"sidebar:removeAll"</span>).subscribe(removeAll);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>on click in the sidebar, select the node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"sidebar:click"</span>).subscribe(<span class="function"><span class="keyword">function</span> <span class="params">(id, e)</span> {</span> 
			radio(<span class="string">"node:select"</span>).broadcast(id, e);
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>on hover in the sidebar, broadcast node:current</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"sidebar:hover"</span>).subscribe(<span class="function"><span class="keyword">function</span> <span class="params">(id, e)</span> {</span> 
			radio(<span class="string">"node:mouseover"</span>).broadcast(id, e);
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>on mouseout in the sidebar, broadcast node:current</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"sidebar:hoverout"</span>).subscribe(<span class="function"><span class="keyword">function</span> <span class="params">(id, e)</span> {</span> 
			radio(<span class="string">"node:mouseout"</span>).broadcast(id, e);
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>when we click remove in the sidebar, unscheduled the item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"sidebar:remove"</span>).subscribe(<span class="function"><span class="keyword">function</span> <span class="params">(id, e)</span> {</span> 
			radio(<span class="string">"node:unschedule"</span>).broadcast(id, e);
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Hide the sidebar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"sidebar:hide"</span>).subscribe(hide);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Show the sidebar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"sidebar:show"</span>).subscribe(show);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>When the windows is resized, change UI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"window:resize"</span>).subscribe(resize);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>When the dom is ready, update the UI:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"domready"</span>).subscribe(resize);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Current node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"node:select"</span>).subscribe(putInfo);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Unselect it when click somewhere else</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"node:unselect"</span>).subscribe(removeInfo);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Add new event to open a particular tab:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		radio(<span class="string">"sidebar:tab"</span>).subscribe(openTab);


	}</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>////////////////////////////////////////////
                                        //
                 Init                    //
                                        //
////////////////////////////////////////////</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	
	<span class="comment">/**
	 * Initializes the sidebar plus events
	 * TODO: Break this function up to smaller bits and pull the events 
	 * out
	 */</span>
	sidebar.init = <span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Make remove button work</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="string">".removeall"</span>).click( <span class="keyword">function</span>() { removeVerify(); });</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Make generate schedule button work</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="string">".downpdf"</span>).click(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> abstractVerify(<span class="number">0</span>); });</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Make generate schedule button work</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="string">".downicn"</span>).click(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> abstractVerify(<span class="number">1</span>); });</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Call events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		sidebar.events();</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Set the UI height:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		resize();</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Init the tabs:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="string">'#tabs'</span>).tabs();</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Make sidebar open and close working:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="string">"#closeSidebar"</span>).click( <span class="keyword">function</span>() { toggleSidebar(); });
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>////////////////////////////////////////////
                                        //
            Private Functions            //
                                        //
////////////////////////////////////////////</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	

	<span class="comment">/**
	 * Updates the list with the current element
	 */</span>
	<span class="keyword">var</span> setFocus = <span class="keyword">function</span>(node) {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Removes current from last list item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="string">".listItem.current"</span>).removeClass(<span class="string">"current"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Adds current to the current list item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="string">"#"</span> + node.id).addClass(<span class="string">"current"</span>);
	}


	<span class="comment">/**
	 * Updates the list when unselecting a node
	 */</span>
	<span class="keyword">var</span> unsetFocus = <span class="function"><span class="keyword">function</span> <span class="params">(node)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Removes current from last list item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="string">".listItem.current"</span>).removeClass(<span class="string">"current"</span>);
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Renders the schedule with dates and all</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	render = <span class="keyword">function</span>() {
		<span class="keyword">var</span> scheduled = nodeList.scheduled;
		<span class="keyword">var</span> sorted = scheduled.sort(<span class="keyword">function</span>(s1,s2) { <span class="keyword">return</span> s1.time - s2.time });
		<span class="keyword">var</span> days = sorted.map(<span class="keyword">function</span>(s) { <span class="keyword">return</span> unixTime.toDate(s.time/<span class="number">1000</span>); });</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Now loop through sorted and build the html items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">var</span> listItems = sorted.map(<span class="keyword">function</span>(s) { <span class="keyword">return</span> buildListItem(s) });

		<span class="keyword">var</span> div = $(<span class="string">"&lt;ul&gt;"</span>);
		listItems.forEach(<span class="keyword">function</span>(item, i) {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>If we start a new day, then</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="keyword">if</span> (i == <span class="number">0</span> || days[i].format(<span class="string">"yymmdd"</span>) != days[i-<span class="number">1</span>].format(<span class="string">"yymmdd"</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Insert date</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="keyword">var</span> d = days[i].format(<span class="string">"fullDate"</span>);
				div.append(<span class="string">"&lt;span class=\"listDate\"&gt;"</span> + d + <span class="string">"&lt;/span&gt;"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Create new list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				div.append($(<span class="string">"&lt;ul&gt;"</span>).addClass(<span class="string">"sidebarDay"</span>).append(item));
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>If not, just insert item to last list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			div.find(<span class="string">"ul"</span>).last().append(item);
		});

		$(<span class="string">"#schedule"</span>).html(div);


	}


	<span class="keyword">var</span> buildListItem = <span class="keyword">function</span>(node) {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Clone listItemTemplate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">var</span> item = $(<span class="string">"#listItemTemplate"</span>).clone();
		item.css(<span class="string">"display"</span>,<span class="string">"block"</span>);
		item.attr(<span class="string">"id"</span>, node.id);</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Add information</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		item.find(<span class="string">".listItemText"</span>).html(truncate(node.title, <span class="number">62</span>));
		item.find(<span class="string">".listItemPdfLink"</span>).attr(<span class="string">"href"</span>,node.pdf);
		item.find(<span class="string">"input"</span>).attr(<span class="string">"value"</span>, node.id);</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Add mouseover event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		item.mouseover(<span class="function"><span class="keyword">function</span> <span class="params">(e)</span> {</span> 
			radio(<span class="string">"sidebar:hover"</span>).broadcast(node,e); 
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Add click event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		item.click(<span class="function"><span class="keyword">function</span> <span class="params">(e)</span> {</span> 
			radio(<span class="string">"sidebar:click"</span>).broadcast(node,e); 
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Add mouseout event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		item.mouseout(<span class="function"><span class="keyword">function</span> <span class="params">(e)</span> {</span> 
			radio(<span class="string">"sidebar:hoverout"</span>).broadcast(node,e); 
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Add remove event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		item.find(<span class="string">".listItemRemove"</span>).click(<span class="function"><span class="keyword">function</span> <span class="params">(e)</span> {</span> 
			radio(<span class="string">"sidebar:remove"</span>).broadcast(node,e); 
		});

		<span class="keyword">return</span> item;
	}




	<span class="comment">/**
	 * What happens when a node is scheduled
	 */</span>
	<span class="keyword">var</span> schedule = <span class="keyword">function</span>(node) {</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Render the new list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		render();</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Set it as the current element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		setFocus(node);</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Move sidebar when close to show it has been added</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">if</span>(!isOpen){
			moveSidebar(-<span class="number">280</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="keyword">function</span>(){ moveSidebar(-<span class="number">310</span>, <span class="number">50</span>, <span class="number">0</span>) });
		}

		radio(<span class="string">'sidebar:tab'</span>).broadcast(<span class="number">0</span>);
	}


	<span class="comment">/**
	 * What happens when a node is scheduled
	 */</span>
	<span class="keyword">var</span> unschedule = <span class="keyword">function</span>(node) {</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Render the new list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		render();

		<span class="keyword">if</span>(!isOpen){
			moveSidebar(-<span class="number">280</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="keyword">function</span>(){ moveSidebar(-<span class="number">310</span>, <span class="number">50</span>, <span class="number">0</span>) });
		}
	}

	<span class="comment">/**
	 * Prompts the user if the want to remove all nodes from list
	 */</span>
	<span class="keyword">var</span> removeVerify = <span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Hide downloadType if open</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">if</span>(confirm(<span class="string">"Are you sure? "</span>)) radio(<span class="string">"sidebar:removeAll"</span>).broadcast();
	}


	<span class="comment">/**
	 * Promps the user if they want to include an abstract with the pdf
	 */</span>
	<span class="keyword">var</span> abstractVerify = <span class="keyword">function</span>(type) {
		
		<span class="keyword">var</span> $dialog = $(<span class="string">'&lt;div&gt;&lt;/div&gt;'</span>)
		.html(<span class="string">'Do you want to include abstract of the papers?'</span>)
		.dialog({
			      resizable: <span class="literal">false</span>,
			      modal: <span class="literal">true</span>,
			      buttons: {
			        <span class="string">"Yes with abstract"</span>: <span class="keyword">function</span>() {
			          $( <span class="keyword">this</span> ).dialog( <span class="string">"close"</span> );
			          <span class="keyword">if</span>(type == <span class="number">0</span>){
							withAbstract(<span class="number">1</span>);
						}<span class="keyword">else</span>{
							downloadIcal(<span class="number">1</span>);
						}
			        },
			        <span class="string">"No, without"</span>: <span class="keyword">function</span>() {
			          $( <span class="keyword">this</span> ).dialog( <span class="string">"close"</span> );
			          <span class="keyword">if</span>(type == <span class="number">0</span>){
							withAbstract(<span class="number">0</span>);
						}<span class="keyword">else</span>{
							downloadIcal(<span class="number">0</span>);
						}
			        }
			      }
			    });

	
		$dialog.dialog(<span class="string">'open'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>var abst = (confirm(&quot;Do you want to include abstract of the papers? &quot;)) ? 1: 0 ;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
	}


	<span class="comment">/**
	 * What happens when we click on getSmall
	 */</span>
	<span class="keyword">var</span> withAbstract = <span class="keyword">function</span>(abst) {</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Update hidden field</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="string">"input[name=abstract]"</span>).attr(<span class="string">"value"</span>,abst);</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Get all the nodes in the schedule:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">var</span> scheduled = nodeList.scheduled;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>generate the pdf</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">var</span> t = <span class="keyword">new</span> Pdf(scheduled, abst == <span class="number">1</span> );
		t.send();
	}


	<span class="comment">/**
	 * Create a document on ical format:
	 */</span>

	<span class="keyword">var</span> downloadIcal = <span class="keyword">function</span>(abst){</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>create the ical document:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">var</span> icalDoc = <span class="keyword">new</span> iCal();</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Add each in node in the ical document:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		nodeList.scheduled.forEach(<span class="keyword">function</span>(node) {</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>create the description of the event:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="keyword">var</span> description = <span class="string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>create author string:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			node.authors.forEach(<span class="keyword">function</span>(author, i) { description += (i &gt; <span class="number">0</span>) ? <span class="string">", "</span>+author: author; });</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>if we want abastract in the ical event:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="keyword">if</span>(abst == <span class="number">1</span>) description += <span class="string">"\n"</span>+node.getCachedAbstract().substr(<span class="number">11</span>).replace(<span class="regexp">/(\r\n|\n|\r)/gm</span>,<span class="string">""</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>create ending date:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="keyword">var</span> start = node.getDate();
			<span class="keyword">var</span> end = <span class="keyword">new</span> Date( start.getTime()+param[<span class="string">'talk_duration'</span>]*<span class="number">60</span>*<span class="number">1000</span> );
			icalDoc.addEvent(start, end, node.title, node.room, description );
					
		});

		icalDoc.send();

	}

	<span class="comment">/**
	 * Removes all nodes from list
	 */</span>
	<span class="keyword">var</span> removeAll = <span class="keyword">function</span>() {

		radio(<span class="string">"node:unscheduleall"</span>).broadcast();
	}

	
	<span class="comment">/**
	 * Open or close the sidebar
	 */</span>
	<span class="keyword">var</span> toggleSidebar = <span class="keyword">function</span>() {
		<span class="keyword">if</span>(isOpen){
			radio(<span class="string">"sidebar:hide"</span>).broadcast();
			isOpen = <span class="literal">false</span>;
		}<span class="keyword">else</span>{
			radio(<span class="string">"sidebar:show"</span>).broadcast();
			isOpen = <span class="literal">true</span>;
		}
	}
	
	<span class="comment">/**
	 * Move the side bar
	 */</span>
	
	<span class="keyword">var</span> moveSidebar = <span class="keyword">function</span>(dist, duration, rot, callback) {
		<span class="keyword">if</span>(dist == <span class="literal">null</span>) dist = -<span class="number">310</span>;
		<span class="keyword">if</span>(duration == <span class="literal">null</span>) duration = <span class="number">300</span>;
		<span class="keyword">if</span>(rot == <span class="literal">null</span>) rot = <span class="number">0</span>;

		$(<span class="string">'#tabs'</span>).animate({<span class="string">"left"</span>: <span class="string">""</span>+dist+<span class="string">"px"</span>}, duration, callback);
		$(<span class="string">'#closeSidebar'</span>).animate({<span class="string">"left"</span>: <span class="string">""</span>+(dist+<span class="number">310</span>)+<span class="string">"px"</span>}, duration);
		$(<span class="string">'#closeSidebar div'</span>).transition({ rotate: <span class="string">""</span>+rot+<span class="string">'deg'</span> });
	}

	<span class="comment">/**
	 * Hide the side bar
	 */</span>

	 <span class="keyword">var</span> hide = <span class="keyword">function</span>(){
	 	moveSidebar();
	 }
	
	<span class="comment">/**
	 * Show the side bar
	 */</span>
	 
	 <span class="keyword">var</span> show = <span class="keyword">function</span>() {

		moveSidebar(<span class="number">0</span>, <span class="number">300</span>, <span class="number">180</span>);
	 }
	
	
	<span class="comment">/**
	 * Update the UI of the tabs accordingly of the windows height:
	 */</span>
	<span class="keyword">var</span> resize = <span class="keyword">function</span>(w, h){
	
		$(<span class="string">'#tabs'</span>).css(<span class="string">'height'</span>, h);
		$(<span class="string">'#tabs .scrollable'</span>).css(<span class="string">'height'</span>, h-<span class="number">248</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Later will implement a scroll only on the summary:
$(&quot;#tab1-summary&quot;).css(&#39;height&#39;, h-440);
A bit complicate, &#39;cause need to compute the size the header take (title, authors...)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
	}

	<span class="comment">/**
	 * Show information of the current node in the info tab:
	 */</span>
	<span class="keyword">var</span> putInfo = <span class="keyword">function</span>(node){
		

		<span class="keyword">var</span> template = <span class="keyword">function</span>(id, title, time, abstract, room, authors){
			
			<span class="keyword">var</span> goog = <span class="string">'http://www.google.com/search?ie=UTF-8&amp;oe=UTF-8&amp;sourceid=navclient&amp;btnI=1&amp;q='</span>;
			<span class="keyword">var</span> domEl = $(<span class="string">'#template_info'</span>).clone();
			domEl.css(<span class="string">"display"</span>,<span class="string">"block"</span>);
			domEl.attr(<span class="string">"id"</span>, id);

			<span class="keyword">var</span> authorString = <span class="string">""</span>;
			authors.forEach( <span class="keyword">function</span>(author, i) {

				<span class="keyword">var</span> authURL = goog + author.replace(<span class="string">" "</span>,<span class="string">"+"</span>);
				<span class="keyword">if</span>(i == <span class="number">0</span>) authorString += <span class="string">'By &lt;a href="'</span> + authURL + <span class="string">'" target="_blank"&gt;'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>else if (authors.length == 2) authorString += &#39; and <ahref="' + authURL + '" target="_blank">&#39;;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="keyword">else</span> <span class="keyword">if</span> (i == authors.length - <span class="number">1</span>) authorString += <span class="string">' and &lt;a href="'</span> + authURL + <span class="string">'" target="_blank"&gt;'</span>;
				<span class="keyword">else</span> authorString += <span class="string">', &lt;a href="'</span> + authURL + <span class="string">'" target="_blank"&gt;'</span>;

				authorString += author;
				authorString += <span class="string">'&lt;/a&gt;'</span>;
			});</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Get conference</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="keyword">var</span> baseurl = params[<span class="string">'conference_data'</span>] + params[<span class="string">'conference_abbr'</span>] + <span class="string">'/'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Add thumb:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			domEl.find(<span class="string">'.thumb'</span>).append($(<span class="string">'&lt;img src="'</span> + baseurl + id +<span class="string">'_thumb.jpg" width="50" /&gt;'</span>).error(<span class="keyword">function</span>() {
  				domEl.find(<span class="string">'.thumb'</span>).remove();
  				domEl.find(<span class="string">'.authors'</span>).css(<span class="string">'width'</span>, <span class="string">'100%'</span>);
			}));</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>check if pdf exist:
$.ajax({
    url:baseurl + id + &#39;.pdf&#39;,
    type:&#39;HEAD&#39;, 
    error: function(){
        // Remove link
        domEl.find(&#39;.pdf_dwn&#39;).remove();
    },
    success: function(){
        // Add pdf url:
        domEl.find(&#39;.pdf_dwn a&#39;).attr(&#39;href&#39;, url);
    }
});</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			domEl.find(<span class="string">'.pdf_dwn'</span>).remove();



			domEl.find(<span class="string">'.title'</span>).html(title);
			domEl.find(<span class="string">'.time b'</span>).html(  time.format(<span class="string">"HH:MM  mmm d, yyyy"</span>) );

			<span class="keyword">var</span> rooml = room.substr(<span class="number">0</span>, <span class="number">15</span>);
			<span class="keyword">if</span>(room.length &gt; <span class="number">15</span> ) rooml += <span class="string">"..."</span>;

			domEl.find(<span class="string">'.location b'</span>).html( rooml  );
			domEl.find(<span class="string">'.authors'</span>).html(authorString);
			domEl.find(<span class="string">'.abstract'</span>).html(abstract);

			<span class="keyword">return</span> domEl;


		}</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Default abstract (loader in case we are loading from the web 
server)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">var</span> abstract = <span class="string">"&lt;img class=\"loading\" src=\"/img/ajax-loader_dark.gif\" style=\"margin:3px 0\"/&gt;&lt;span class=\"loading-text\"&gt;Loading Abstract...&lt;/span&gt;"</span>;

		$(<span class="string">'#tabs-1'</span>).find(<span class="string">'.content_tab'</span>).html( template( node.id, node.title, node.getDate(), abstract, node.room, node.authors ));</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>If the abstract isn&#39;t cached, fetch it
It&#39;s in the end in case we get it really fast</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		node.getAbstract(<span class="keyword">function</span>(data) {
			$(<span class="string">".abstract"</span>).html(data); 
		});
	 }

	 <span class="comment">/**
	 * Show information of the current node in the info tab:
	 */</span>
	 <span class="keyword">var</span> removeInfo = <span class="keyword">function</span>(node){
	 		$(<span class="string">'#tabs-1'</span>).html(<span class="string">'&lt;div class="form-w" style="margin-top:40px; text-align:center;"&gt;no node selected&lt;/div&gt;'</span>);
	 }

	 <span class="keyword">var</span> openTab = <span class="keyword">function</span>(tabIndex){
		$( <span class="string">"#tabs"</span> ).tabs( <span class="string">"option"</span>, <span class="string">"active"</span>,  tabIndex);
	 }</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Export the controller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	sidebar.init();
	<span class="keyword">return</span> sidebar;
})</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
