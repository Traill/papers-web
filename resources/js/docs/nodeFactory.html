<!DOCTYPE html>

<html>
<head>
  <title>nodeFactory.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="controller.html">
                controller.js
              </a>
            
              
              <a class="source" href="position.html">
                position.js
              </a>
            
              
              <a class="source" href="session.html">
                session.js
              </a>
            
              
              <a class="source" href="test.html">
                test.js
              </a>
            
              
              <a class="source" href="ui.html">
                ui.js
              </a>
            
              
              <a class="source" href="cluster.html">
                cluster.js
              </a>
            
              
              <a class="source" href="clustering.html">
                clustering.js
              </a>
            
              
              <a class="source" href="graph.html">
                graph.js
              </a>
            
              
              <a class="source" href="linkFactory.html">
                linkFactory.js
              </a>
            
              
              <a class="source" href="linkList.html">
                linkList.js
              </a>
            
              
              <a class="source" href="nodeFactory.html">
                nodeFactory.js
              </a>
            
              
              <a class="source" href="nodeList.html">
                nodeList.js
              </a>
            
              
              <a class="source" href="saveLink.html">
                saveLink.js
              </a>
            
              
              <a class="source" href="search.html">
                search.js
              </a>
            
              
              <a class="source" href="zoom.html">
                zoom.js
              </a>
            
              
              <a class="source" href="array.html">
                array.js
              </a>
            
              
              <a class="source" href="cookie.html">
                cookie.js
              </a>
            
              
              <a class="source" href="curry.html">
                curry.js
              </a>
            
              
              <a class="source" href="dateFormat.html">
                dateFormat.js
              </a>
            
              
              <a class="source" href="datepicker.html">
                datepicker.js
              </a>
            
              
              <a class="source" href="delay.html">
                delay.js
              </a>
            
              
              <a class="source" href="dimensions.html">
                dimensions.js
              </a>
            
              
              <a class="source" href="getRandomDate.html">
                getRandomDate.js
              </a>
            
              
              <a class="source" href="ical.html">
                ical.js
              </a>
            
              
              <a class="source" href="levenshtein.html">
                levenshtein.js
              </a>
            
              
              <a class="source" href="merge.html">
                merge.js
              </a>
            
              
              <a class="source" href="paragraphy.html">
                paragraphy.js
              </a>
            
              
              <a class="source" href="pdf.html">
                pdf.js
              </a>
            
              
              <a class="source" href="screen.html">
                screen.js
              </a>
            
              
              <a class="source" href="truncate.html">
                truncate.js
              </a>
            
              
              <a class="source" href="unixTime.html">
                unixTime.js
              </a>
            
              
              <a class="source" href="graph.html">
                graph.js
              </a>
            
              
              <a class="source" href="infobox.html">
                infobox.js
              </a>
            
              
              <a class="source" href="links.html">
                links.js
              </a>
            
              
              <a class="source" href="loader.html">
                loader.js
              </a>
            
              
              <a class="source" href="map.html">
                map.js
              </a>
            
              
              <a class="source" href="menu.html">
                menu.js
              </a>
            
              
              <a class="source" href="message.html">
                message.js
              </a>
            
              
              <a class="source" href="saveLink.html">
                saveLink.js
              </a>
            
              
              <a class="source" href="search.html">
                search.js
              </a>
            
              
              <a class="source" href="selectBox.html">
                selectBox.js
              </a>
            
              
              <a class="source" href="sidebar.html">
                sidebar.js
              </a>
            
              
              <a class="source" href="views.html">
                views.js
              </a>
            
              
              <a class="source" href="zoomer.html">
                zoomer.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>nodeFactory.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>define([<span class="string">"controllers/position"</span>, <span class="string">"util/merge"</span>, <span class="string">"params"</span>, <span class="string">"util/unixTime"</span>], 
	<span class="keyword">function</span>(position, merge, config, unixTime) {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>////////////////////////////////////////////
                                        //
              Interface                    //
                                        //
////////////////////////////////////////////</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">var</span> nodeFactory = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>////////////////////////////////////////////
                                        //
               Events                    //
                                        //
////////////////////////////////////////////</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>There are no events in node for a very good reason: If an event is
called it will trigger functions for every single node created. This is
most likely not what we want, so think about what you are doing before
adding an event here. Instead put an event in the nodes model and handle
it there</p>
<p>////////////////////////////////////////////
                                        //
             Initialize                    //
                                        //
////////////////////////////////////////////</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	
	nodeFactory.<span class="keyword">new</span> = <span class="keyword">function</span>(data, index) {
		
		<span class="keyword">var</span> n =	{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					domNode:	<span class="literal">null</span>,
					links:		<span class="keyword">new</span> Object(),</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>pos:        initPosition(index) ,</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>to be complient with force layout:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					x:			initPosition(data.id).x,
					y:			initPosition(data.id).y,
					weight:		<span class="number">1</span>,
					index:		index,</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Methods
isScheduled:    isScheduledFun,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					getAbstract:	getAbstractFun,
					getCachedAbstract:	getCachedAbstract,
					getDate:		getDateFun,
					addLink:		addLinkFun
				}

		<span class="keyword">return</span> merge(n,data);
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>////////////////////////////////////////////
                                        //
               Functions                    //
                                        //
////////////////////////////////////////////</p>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>A function to add a link to a node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">var</span> addLinkFun = <span class="keyword">function</span>(link, target) {
		
		<span class="keyword">this</span>.links[link.index] = { link: link, targetNode: target }
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Fetch an abstract per ajax</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">var</span> getAbstractFun = <span class="keyword">function</span>(callback) {
		<span class="keyword">var</span> self = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>If we have an abstract already, call the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">if</span>(self.abstract) { <span class="keyword">if</span> (callback != <span class="literal">undefined</span>) <span class="keyword">return</span> callback(self.abstract); }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>If not, then fetch abstract from server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">else</span> {
			$.get(<span class="string">"/ajax/abstract/"</span> + self.id, {}, <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> {</span> 
				<span class="keyword">if</span> (data.success == <span class="literal">true</span>) {
					self.abstract = data.abstract;
				} <span class="keyword">else</span> {
					self.abstract = <span class="string">"Not found"</span>;
				}

				<span class="keyword">if</span> (callback != <span class="literal">undefined</span>) <span class="keyword">return</span> callback(self.abstract);
			});
		}
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Return the cached abstract or throws an error if it hasn&#39;t been fetched yet</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">var</span> getCachedAbstract = <span class="keyword">function</span>() {
		<span class="keyword">if</span> (<span class="keyword">this</span>.abstract) <span class="keyword">return</span> <span class="keyword">this</span>.abstract
		<span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Abstract not set in advance before calling getCachedAbstract"</span>)
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Get date from node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">var</span> getDateFun = <span class="keyword">function</span>() {
		<span class="keyword">var</span> date = unixTime.toDate(<span class="keyword">this</span>.time/<span class="number">1000</span>)
		<span class="keyword">return</span> date;
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Find initial position of the node, else create it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">var</span> initPosition = <span class="keyword">function</span>(id) {
		<span class="keyword">var</span> pos = {};
		<span class="keyword">if</span>(position.get(id) == <span class="literal">null</span>){
			
			pos.x = config[<span class="string">'graph_width'</span>]*Math.random();
			pos.y = config[<span class="string">'graph_height'</span>]*Math.random();
			
		}<span class="keyword">else</span> {
			pos = position.get(id);
		}
		<span class="keyword">return</span> pos;
	
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Return the nodeFactory</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">return</span> nodeFactory;
})</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
